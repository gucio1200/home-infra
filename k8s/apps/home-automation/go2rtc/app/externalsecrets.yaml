---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: go2rtc-config
spec:
  refreshInterval: 5m
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: go2rtc-config
    creationPolicy: Owner
    template:
      data:
        "config": |
          api:
            listen: :80
          rtsp:
            listen: :554
          webrtc:
            listen: :8555
            candidates:
              - stun:8555
          streams:
            camera_1_lq:
              - rtsp://{{ .go2rtc_username }}:{{ .go2rtc_password }}@192.168.5.1/streaming/channels/103
            camera_1_hq:
              - rtsp://{{ .go2rtc_username }}:{{ .go2rtc_password }}@192.168.5.1/streaming/channels/101
            camera_2_lq:
              - rtsp://{{ .go2rtc_username }}:{{ .go2rtc_password }}@192.168.5.2/streaming/channels/103
            camera_2_hq:
              - rtsp://{{ .go2rtc_username }}:{{ .go2rtc_password }}@192.168.5.2/streaming/channels/101
            camera_3_lq:
              - rtsp://{{ .go2rtc_username }}:{{ .go2rtc_password }}@192.168.5.3/streaming/channels/103
            camera_3_hq:
              - rtsp://{{ .go2rtc_username }}:{{ .go2rtc_password }}@192.168.5.3/streaming/channels/101
            camera_4_lq:
              - rtsp://{{ .go2rtc_username }}:{{ .go2rtc_password }}@192.168.5.4/streaming/channels/103
            camera_4_hq:
              - rtsp://{{ .go2rtc_username }}:{{ .go2rtc_password }}@192.168.5.4/streaming/channels/101
  dataFrom:
    - extract:
        key: go2rtc
      rewrite:
        - regexp:
            source: "[^a-zA-Z0-9-]"
            target: "_"
        - regexp:
            source: "(.*)"
            target: "go2rtc_$1"
